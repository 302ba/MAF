CREATE DATABASE 'localhost:D:\DB\MAF_Sample.FDB'
USER 'SYSDBA' PASSWORD '**********'
PAGE_SIZE 4096
DEFAULT CHARACTER SET NONE;

/* Generators */
CREATE SEQUENCE GEN_MAF_STORAGE_ID;

ALTER SEQUENCE GEN_MAF_STORAGE_ID RESTART WITH 0;
CREATE SEQUENCE GEN_MAF_USERS_ID;

ALTER SEQUENCE GEN_MAF_USERS_ID RESTART WITH 0;
CREATE SEQUENCE MAF_GROUPS_ID_GEN;

ALTER SEQUENCE MAF_GROUPS_ID_GEN RESTART WITH 0;

/* Tables */
CREATE TABLE MAF_GROUPS (
  ID    INTEGER NOT NULL,
  NAME  VARCHAR(100) NOT NULL,
  SL    SMALLINT DEFAULT 1 NOT NULL
);

CREATE TABLE MAF_STORAGE (
  DATAID         INTEGER NOT NULL,
  DATA_CATEGORY  VARCHAR(30) NOT NULL,
  DATA_NAME      VARCHAR(30) NOT NULL,
  DATA_STORAGE   BLOB SUB_TYPE BINARY SEGMENT SIZE 20
);

CREATE TABLE MAF_USERS (
  ID            INTEGER NOT NULL,
  LOGIN         VARCHAR(30),
  GROUPID       INTEGER,
  ACCOUNT_DATA  BLOB SUB_TYPE BINARY SEGMENT SIZE 20
);
COMMIT;

/* Constraints */
ALTER TABLE MAF_GROUPS
  ADD PRIMARY KEY (ID);

ALTER TABLE MAF_STORAGE
  ADD PRIMARY KEY (DATAID);

/* Triggers */
SET TERM ^ ;
CREATE TRIGGER MAF_GROUPS_BI FOR MAF_GROUPS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
NEW.ID = GEN_ID(MAF_GROUPS_ID_GEN, 1);
END^

CREATE TRIGGER MAF_STORAGE_BI FOR MAF_STORAGE
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
  NEW.DATAID = GEN_ID(GEN_MAF_STORAGE_ID, 1);
END^

CREATE TRIGGER MAF_USERS_BI FOR MAF_USERS
ACTIVE BEFORE INSERT POSITION 0
AS
BEGIN
NEW.ID = GEN_ID(GEN_MAF_USERS_ID,1);
END^
SET TERM ; ^

